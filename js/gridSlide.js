// $.getJSON("../Data2_3.json", function(data){
  var data = {
    "Axes": {
      "Axis": [
        [
          {
            "Member": [
              {
                "index": 0,
                "hierarchy": "Measures",
                "UName": "[Measures].[Actual]",
                "Caption": "Actual",
                "LName": "[Measures].[MeasuresLevel]",
                "LNum": 0,
                "DisplayInfo": 0
              },
              {
                "index": 1,
                "hierarchy": "Region",
                "UName": "[Region].[All Regions]",
                "Caption": "All Regions",
                "LName": "[Region].[(All)]",
                "LNum": 0,
                "DisplayInfo": 65540
              },
              {
                "index": 2,
                "hierarchy": "Region",
                "UName": "[Region].[xyz]",
                "Caption": "All Regions hjbdsifiudsafiuafwab",
                "LName": "[Region].[(All)]",
                "LNum": 0,
                "DisplayInfo": 65540
              }
            ]
          },
          {
            "Member": [
              {
                "index": 0,
                "hierarchy": "Measures",
                "UName": "[Measures].[Actual]",
                "Caption": "Actual",
                "LName": "[Measures].[MeasuresLevel]",
                "LNum": 0,
                "DisplayInfo": 0
              },
              {
                "index": 1,
                "hierarchy": "Region",
                "UName": "[Region].[Central]",
                "Caption": "Central",
                "LName": "[Region].[Region]",
                "LNum": 1,
                "DisplayInfo": 0
              },
              {
                "index": 2,
                "hierarchy": "Region",
                "UName": "[Region].[xyz]",
                "Caption": "All Regions",
                "LName": "[Region].[(All)]",
                "LNum": 0,
                "DisplayInfo": 65540
              }
            ]
          },
          {
            "Member": [
              {
                "index": 0,
                "hierarchy": "Measures",
                "UName": "[Measures].[Budget]",
                "Caption": "Budget",
                "LName": "[Measures].[MeasuresLevel]",
                "LNum": 0,
                "DisplayInfo": 0
              },
              {
                "index": 1,
                "hierarchy": "Region",
                "UName": "[Region].[Eastern]",
                "Caption": "Eastern",
                "LName": "[Region].[Region]",
                "LNum": 1,
                "DisplayInfo": 131072
              },
              {
                "index": 2,
                "hierarchy": "Region",
                "UName": "[Region].[xyz]",
                "Caption": "All Regions",
                "LName": "[Region].[(All)]",
                "LNum": 0,
                "DisplayInfo": 65540
              }
            ]
          },
          {
            "Member": [
              {
                "index": 0,
                "hierarchy": "Measures",
                "UName": "[Measures].[Budget]",
                "Caption": "Budget",
                "LName": "[Measures].[MeasuresLevel]",
                "LNum": 0,
                "DisplayInfo": 0
              },
              {
                "index": 1,
                "hierarchy": "Region",
                "UName": "[Region].[Southern]",
                "Caption": "Southern",
                "LName": "[Region].[Region]",
                "LNum": 1,
                "DisplayInfo": 131072
              },
              {
                "index": 2,
                "hierarchy": "Region",
                "UName": "[Region].[xyz]",
                "Caption": "All Regions",
                "LName": "[Region].[(All)]",
                "LNum": 0,
                "DisplayInfo": 65540
              }
            ]
          },
          {
            "Member": [
              {
                "index": 0,
                "hierarchy": "Measures",
                "UName": "[Measures].[Budget]",
                "Caption": "Budget",
                "LName": "[Measures].[MeasuresLevel]",
                "LNum": 0,
                "DisplayInfo": 0
              },
              {
                "index": 1,
                "hierarchy": "Region",
                "UName": "[Region].[Western]",
                "Caption": "Western",
                "LName": "[Region].[Region]",
                "LNum": 1,
                "DisplayInfo": 131072
              },
              {
                "index": 2,
                "hierarchy": "Region",
                "UName": "[Region].[xyz]",
                "Caption": "All Regions",
                "LName": "[Region].[(All)]",
                "LNum": 0,
                "DisplayInfo": 65540
              }
            ]
          }
        ],
        [
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[All Departments]",
                "Caption": "All Departments fifdsifhsaihfiusahiufidsah",
                "LName": "[Department].[(All)]",
                "LNum": 0,
                "DisplayInfo": 65543
              }

            ]
          },
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[Executive Management]",
                "Caption": "Executive Management",
                "LName": "[Department].[Department]",
                "LNum": 1,
                "DisplayInfo": 0
              }
            ]
          },
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[Finance]",
                "Caption": "Finance",
                "LName": "[Department].[Department]",
                "LNum": 1,
                "DisplayInfo": 131072
              }
            ]
          },
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[Human Resource]",
                "Caption": "Human Resource",
                "LName": "[Department].[Department]",
                "LNum": 1,
                "DisplayInfo": 131072
              }
            ]
          },
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[Marketing & Communication]",
                "Caption": "Marketing & Communication",
                "LName": "[Department].[Department]",
                "LNum": 1,
                "DisplayInfo": 131072
              }
            ]
          },
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[Product Development]",
                "Caption": "Product Development",
                "LName": "[Department].[Department]",
                "LNum": 1,
                "DisplayInfo": 131072
              }
            ]
          },
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[Professional Services]",
                "Caption": "Professional Services",
                "LName": "[Department].[Department]",
                "LNum": 1,
                "DisplayInfo": 131072
              }
            ]
          },
          {
            "Member": [
              {
                "index": 1,
                "hierarchy": "Positions",
                "UName": "[Positions].[All Positions]",
                "Caption": "All Positions",
                "LName": "[Positions].[(All)]",
                "LNum": 0,
                "DisplayInfo": 37
              },
              {
                "index": 0,
                "hierarchy": "Department",
                "UName": "[Department].[Sales]",
                "Caption": "Sales",
                "LName": "[Department].[Department]",
                "LNum": 1,
                "DisplayInfo": 131072
              }
            ]
          }
        ]
      ]
    },
    "CellData": {
      "Cell": [
        {
          "CellOrdinal": 0,
          "FmtValue": "143,639,982.00"
        },
        {
          "CellOrdinal": 1,
          "FmtValue": "37,893,162.00"
        },
        {
          "CellOrdinal": 2,
          "FmtValue": "35,248,940.00"
        },
        {
          "CellOrdinal": 3,
          "FmtValue": "35,248,940.00"
        },
        {
          "CellOrdinal": 4,
          "FmtValue": "35,248,940.00"
        },
        {
          "CellOrdinal": 5,
          "FmtValue": "6,299,022.00"
        },
        {
          "CellOrdinal": 6,
          "FmtValue": "1,776,282.00"
        },
        {
          "CellOrdinal": 7,
          "FmtValue": "1,507,580.00"
        },
        {
          "CellOrdinal": 8,
          "FmtValue": "1,507,580.00"
        },
        {
          "CellOrdinal": 9,
          "FmtValue": "1,507,580.00"
        },
        {
          "CellOrdinal": 10,
          "FmtValue": "12,224,220.00"
        },
        {
          "CellOrdinal": 11,
          "FmtValue": "3,106,680.00"
        },
        {
          "CellOrdinal": 12,
          "FmtValue": "3,039,180.00"
        },
        {
          "CellOrdinal": 13,
          "FmtValue": "3,039,180.00"
        },
        {
          "CellOrdinal": 14,
          "FmtValue": "3,039,180.00"
        },
        {
          "CellOrdinal": 15,
          "FmtValue": "13,075,463.00"
        },
        {
          "CellOrdinal": 16,
          "FmtValue": "3,438,863.00"
        },
        {
          "CellOrdinal": 17,
          "FmtValue": "3,212,200.00"
        },
        {
          "CellOrdinal": 18,
          "FmtValue": "3,212,200.00"
        },
        {
          "CellOrdinal": 19,
          "FmtValue": "3,212,200.00"
        },
        {
          "CellOrdinal": 20,
          "FmtValue": "13,910,753.00"
        },
        {
          "CellOrdinal": 21,
          "FmtValue": "3,590,423.00"
        },
        {
          "CellOrdinal": 22,
          "FmtValue": "3,440,110.00"
        },
        {
          "CellOrdinal": 23,
          "FmtValue": "3,440,110.00"
        },
        {
          "CellOrdinal": 24,
          "FmtValue": "3,440,110.00"
        },
        {
          "CellOrdinal": 25,
          "FmtValue": "10,644,102.00"
        },
        {
          "CellOrdinal": 26,
          "FmtValue": "2,997,702.00"
        },
        {
          "CellOrdinal": 27,
          "FmtValue": "2,548,800.00"
        },
        {
          "CellOrdinal": 28,
          "FmtValue": "2,548,800.00"
        },
        {
          "CellOrdinal": 29,
          "FmtValue": "2,548,800.00"
        },
        {
          "CellOrdinal": 30,
          "FmtValue": "76,317,649.00"
        },
        {
          "CellOrdinal": 31,
          "FmtValue": "20,068,039.00"
        },
        {
          "CellOrdinal": 32,
          "FmtValue": "18,749,870.00"
        },
        {
          "CellOrdinal": 33,
          "FmtValue": "18,749,870.00"
        },
        {
          "CellOrdinal": 34,
          "FmtValue": "18,749,870.00"
        },
        {
          "CellOrdinal": 35,
          "FmtValue": "11,168,773.00"
        },
        {
          "CellOrdinal": 36,
          "FmtValue": "2,915,173.00"
        },
        {
          "CellOrdinal": 37,
          "FmtValue": "2,751,200.00"
        },
        {
          "CellOrdinal": 38,
          "FmtValue": "2,751,200.00"
        },
        {
          "CellOrdinal": 39,
          "FmtValue": "2,751,200.00"
        }
      ]
    }
  }
;
(function (containerBox){
  var addElement, ans, fs, members, tdChild;
  containerBox = 'div.grid';
  var container = $(containerBox);
  container.css('overflow','hidden');
  container.append('<div id="section_result">'+
      '<div id="topDiv">'+
        '<div id="topLeft">'+
        '</div>'+
        '<div id="topRight">'+
          '<table id="topRight_dataTable">'+
            '<tbody id="topRight_dataTableBody">'+
              '<script id="topRight_insersion">'+
              '</script>'+
            '</tbody>'+
          '</table>'+
        '</div>'+
      '</div>'+
      '<div id="bottomDiv">'+
        '<div id="bottomLeft">'+
          '<table id="bottomLeft_dataTable">'+
            '<tbody id="bottomLeft_dataTableBody">'+
              '<script id="bottomLeft_insersion">'+
              '</script>'+
            '</tbody>'+
          '</table>'+
        '</div>'+
        '<div id="bottomRight">'+
          '<table id="bottomRight_dataTable">'+
            '<tbody id="bottomRight_dataTableBody">'+
              '<script id="bottomRight_insersion">'+
              '</script>'+
            '</tbody>'+
          '</table>'+
      '</div>'+
      '</div>');

  container.find('#topLeft_insersion').append('{{axis_topLeft}}');
  container.find('#topRight_insersion').append('{{axis_topRight}}');
  container.find('#bottomLeft_insersion').append('{{axis_bottomLeft}}');
  container.find('#bottomRight_insersion').append('{{axis_bottomRight}}');
  var axes = data.Axes,
      axis = axes.Axis,
      axis0 = axis[0], //.Tuples.Tuple
      axis1 = axis[1],
      // axis2 = axis[2].Tuples.Tuple,
      axis0Child = {},
      axis1Child = {};
  /************* Function for graphKey *****************/
  var axis0Names = [];
  for (var index0 in axis0){
     var axis0Member = axis0[index0].Member;
     var axis0Name = '';
     for(var memIndex0 in axis0Member){
       axis0Name = axis0Name+axis0Member[memIndex0].Caption+".";
     }
     axis0Name = axis0Name.substring(0,axis0Name.length-1);
     axis0Names.push(axis0Name);
   }

   /************* Headings for Graph Modal *****************/
   var axis1Names = [];
   for (var index1 in axis1){
      var axis1Member = axis1[index1].Member;
      var axis1Name = '';
      for(var memIndex1 in axis1Member){
        axis1Name = axis1Name+axis1Member[memIndex1].Caption+".";
      }
      axis1Name = axis1Name.substring(0,axis1Name.length-1);
      axis1Names.push(axis1Name);
    }

  /***************** Generating tree structure ****************/
  addElement = function(members, tree, level) {
    var child;
    if (members[0] != null) {
      child = members[0];
      if (!tree[child.UName]) {
        tree[child.UName] = {
          count: 0,
          caption: child.Caption,
          children: {}
        };
      }
      tree[child.UName].count += 1;
      tree[child.UName].level = child.index;
      addElement(members.slice(1), tree[child.UName].children, child.index + 1);
    }
    return tree;
  };

  /***************** Graph Arrays *************/
  var graphKey = [];

  /***************** Axis0 Hierarchical Structure **********/
  axis0Child = axis0.reduce((function(acc, member) {
    return addElement(member.Member, acc, 1);
  }), {});

  /* Inserting empty th in #topLeft */
  // frag0_0 = "";
  // for(var axis0MemberIndex=0, axis0MemberLen = axis0[0].Member.length; axis0MemberIndex < axis0MemberLen; axis0MemberIndex++)
  // {
  //   frag0_0 += "<tr>";
  //   for(var axis1MemberIndex=0, axis1MemberLen = axis1[0].Member.length; axis1MemberIndex < axis1MemberLen; axis1MemberIndex++){
  //     frag0_0 += '<th></th>';
  //     if(axis1MemberIndex == axis1MemberLen-1){
  //       frag0_0 += '</tr>';
  //     }
  //   }
  // }
  // var template0_0 = $.trim(container.find("#topLeft_insersion").html()).replace(/{{axis_topLeft}}/ig,frag0_0);
  // container.find('#topLeft_dataTableBody').append(template0_0);  // #dataTableBody





  /************* Function for rendering axis0 *****************/
  tdAxis0Child = function(element) {
    var a, ele, name,
        frag0 = "<tr>";
    // for(var axis1MemberIndex=0, axis1MemberLen = axis1[0].Member.length; axis1MemberIndex < axis1MemberLen; axis1MemberIndex++){
    //   frag0 += '<th></th>';
    // }
    a = (function() {
      var results, elementArray, prevElementArray;
          results = [];
          elementArray = [];
          prevElementArray = [];
          elementArray.push(element);
      while(elementArray.length !== 0){
        results.push(frag0);
        for(var index in elementArray){
          element = elementArray[index];
          prevElementArray[index] = elementArray[index];
          for (name in element) {
            ele = element[name];
            results.push(("<th colspan='" + ele.count + "' class='level" + ele.level + "'>" + ele.caption + "</th>"));
          }
        }
        results.push("</tr>");
        elementArray = [];
        for(index in prevElementArray){
          element = prevElementArray[index];
          for (name in element) {
            ele = element[name];
            if(Object.keys(ele.children).length !== 0){
              elementArray.push(ele.children);
            }
          }
        }
      }
      return results;
    })();
    return (a.reduce((function(acc, line) {
      return acc + line;
    }), ""));
  };
  // console.log(tdAxis0Child(axis0Child));
  var template0 = $.trim(container.find("#topRight_insersion").html()),
      frag0 = template0.replace(/{{axis_topRight}}/ig,tdAxis0Child(axis0Child));
  container.find('#topRight_dataTableBody').append(frag0);  // #dataTableBody

  /****************************** Data **********************************/
  var cellData = data.CellData,
      cells = cellData.Cell,
      val = [];
  var td = '';
  for (var cellIndex in cells) {
    val[cells[cellIndex].CellOrdinal] = cells[cellIndex].FmtValue;
  }
  var count  = 0,
      dataArray = [],
      graphData = [];
  for (var j = 0, len1 = axis1.length; j < len1; j++) {
    td +='<tr>';
    var tempDataObj = {};
    var graphInnerArray = [];
    for (var i = 0, len = axis0.length; i < len; i++) {
      var graphObj = {};
      if(val[count] !== undefined && val[count] !== null)
      {
        graphObj.key = axis0Names[i];
        graphObj.value = parseFloat(val[count].replace(/,/g,''));
        graphInnerArray.push(graphObj);
      }
      if(val[count] === undefined){
        val[count] = "";
      }
      td += "<td>"+val[count]+"</td>";
      count++;
    }
    td += '</tr>';
    graphData.push(graphInnerArray);
    tempDataObj.td = td;
    dataArray.push(tempDataObj);
  }
  graphData.push(axis1Names);

  /****************************** Axis1 Hierarchical Structure **********************************/
  axis1Child = axis1.reduce((function(acc, member) {
    return addElement(member.Member, acc, 1);
  }), {});
  var elementIndex = 0;

  /************* Function for rendering axis1 *****************/
  var rowId = 0;
  tdAxis1Child = function(element) {
    var a, ele, name;
    if (Object.keys(element).length === 0) {
      return "</tr>";
    }
    else {
      a = (function() {
        var results = [];
        for (name in element) {
          ele = element[name];
          if(Object.keys(ele.children).length === 0){
            results.push(("<tr id='row"+rowId+"' class='dataRow'><th rowspan='" + ele.count + "' class='level" + ele.level + "'>" + ele.caption + "</th></tr>"));
            elementIndex += 1;
            rowId += 1;
          }
          else{
            results.push(("<tr id='row"+rowId+"' class='dataRow'><th rowspan='" + ele.count + "' class='level" + ele.level + "'>" + ele.caption + "</th>") + tdAxis1Child(ele.children));
          }
        }
        return results;
      })();
      return (a.reduce((function(acc, line) {
        return acc + line;
      }), "")).slice(4);
    }
  };
  var template1_1 = $.trim(container.find("#bottomLeft_insersion").html());
  var frag1_1 = template1_1.replace(/{{axis_bottomLeft}}/ig,'<tr '+tdAxis1Child(axis1Child));
  console.log(frag1_1);
  container.find('#bottomLeft_dataTableBody').append(frag1_1);
  /* Appending data in #bottomRight */
  // console.log(td);
  var template1_2 = $.trim(container.find("#bottomRight_insersion").html());
  var frag1_2 = template1_2.replace(/{{axis_bottomRight}}/ig,td);
  container.find('#bottomRight_dataTableBody').append(frag1_2);
  // debugger;
  container.find('#topLeft').css('width',container.find('#bottomLeft').css('width'));
  // console.log(axis0);
  container.find('#topRight').css('width', (parseInt(container.width()) - parseInt(container.find('#topLeft').css('width')) - 20));
  container.find('#topLeft').css('height',container.find('#topRight').css('height'));
  console.log(container.find('#topLeft').css('width'));
  console.log(container.find('#bottomLeft').css('width'));
  container.find('#bottomRight').css('width', (parseInt(container.width()) - parseInt(container.find('#bottomLeft').css('width')) - 20));
  container.find('#bottomRight').css('height', (parseInt(container.height()) - parseInt(container.find('#topRight').css('height')) - 20));
  container.find('#bottomLeft').css('height', (parseInt(container.height()) - parseInt(container.find('#topLeft').css('height')) - 20));

  for(var dataColumnIdx= 0, dataColumnLen = axis0.length; dataColumnIdx < dataColumnLen ; dataColumnIdx++ ){
    var width1 = parseInt(container.find('#topRight tr:last-child').children('th:nth-child('+(parseInt(dataColumnIdx)+1)+')').css('width'));
    var width2 = parseInt(container.find('#bottomRight tr').first().children('td:nth-child('+(parseInt(dataColumnIdx)+1)+')').css('width'));
    console.log(width1+" "+width2);
    if(width1 < width2)
    {
      container.find('#topRight tr:last-child').children('th:nth-child('+(parseInt(dataColumnIdx)+1)+')').css('min-width',parseInt(container.find('#bottomRight tr').first().children('td:nth-child('+(parseInt(dataColumnIdx)+1)+')').css('width')));
    }
    else{
      container.find('#bottomRight tr').children('td:nth-child('+(parseInt(dataColumnIdx)+1)+')').css('min-width',parseInt(container.find('#topRight tr:last-child').children('th:nth-child('+(parseInt(dataColumnIdx)+1)+')').css('width')));
    }
  }
  // debugger;
  for(var dataRowIdx= 1, dataRowLen = axis1.length; dataRowIdx <= dataRowLen ; dataRowIdx++ ){
    var height1 = parseInt(container.find('#bottomLeft tr:nth-child('+(parseInt(dataRowIdx)+1)+')').children('th:last-child').css('height'));
    console.log(height1);
    var height2 = parseInt(container.find('#bottomRight tr:nth-child('+(parseInt(dataRowIdx)+1)+')').children('td').css('height'));
    console.log(height2);
    if(height1 < height2)
    {
      container.find('#bottomLeft tr:nth-child('+(parseInt(dataRowIdx)+1)+')').children('th:last-child').css('height',height2);
    }
    else{
      container.find('#bottomRight tr:nth-child('+(parseInt(dataRowIdx)+1)+')').children('td').first().css('height',height1);
    }
  }

  /* Linking scroll bars */
  $('#bottomRight').scroll(function(){
    $('#topRight').scrollLeft($(this).scrollLeft());
    $('#bottomLeft').scrollTop($(this).scrollTop());
    $(this).scrollTop($('#bottomLeft').scrollTop());
  });



  return graphData;
})();
